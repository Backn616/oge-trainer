<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ó–∞–¥–∞–Ω–∏–µ 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- –®—Ä–∏—Ñ—Ç –∫–∞–∫ –≤ prepare/task -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ -->
  <link rel="stylesheet" href="../../../style_common.css" />

  <!-- –ê–Ω—Ç–∏-–º–∏–≥–∞–Ω–∏–µ —Ç–µ–º—ã -->
  <script>
    (function(){
      try{
        const saved = localStorage.getItem('pref-theme') || 'light';
        if (saved === 'dark') document.documentElement.classList.add('dark');
      }catch(_){}
    })();
  </script>

  <style>
    body{
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 70% -10%, #29417a40, transparent),
        radial-gradient(900px 500px at -10% 10%, #344b9340, transparent),
        var(--bg);
    }

    .wrap{ max-width: 1600px; width: 95%; margin: 0 auto; padding-top: 24px; }
    h1{ color:var(--primary); font-size:36px; margin:12px 0 6px; text-align:center; }
    .status{ font-size:20px; color:#1f7a2e; text-align:center; margin:6px 0 26px; }
    .dark .status{ color:#5ee397; }

    /* –ü–ª–µ–µ—Ä –∏ –≤–æ–ª–Ω–∞ */
    audio{ margin:20px auto 10px; width:min(900px,95%); display:block; }
    .wave-wrap{ width:min(900px,95%); margin:0 auto 16px; display:none; }
    .wave{ width:100%; height:48px; display:block; background:#e9edf7; border-radius:10px; box-shadow:var(--shadow); }
    .dark .wave{ background:#1f2a3d; }

    /* –¶–≤–µ—Ç–∞ –≤–æ–ª–Ω—ã */
    :root{
      --wave-base: rgba(0,0,0,.28);
      --wave-prog: var(--primary);
      --wave-glow: rgba(43,108,255,.45);
    }
    html.dark{
      --wave-base: rgba(255,255,255,.52);
      --wave-prog: #5bb8ff;
      --wave-glow: rgba(91,184,255,.65);
    }

    .btn{
      display:inline-block; padding:16px 32px; margin:12px;
      font-size:20px; font-weight:600; color:#fff; text-decoration:none; cursor:pointer;
      border:none; border-radius:12px;
      background:linear-gradient(135deg, var(--primary), var(--primary-600));
      box-shadow:0 10px 22px rgba(43,108,255,.3);
      transition: transform .06s ease, filter .2s ease, box-shadow .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }

    /* –†–∞–º–∫–∞ —Ç–µ–∫—Å—Ç–∞ */
    .reading-box{
      max-width:1200px; width:95%; margin:0 auto 24px;
      font-size:25px; line-height:1.7; text-align:left;
      border:1px solid #ccc; padding:24px 28px; border-radius:12px;
      background:var(--card); box-shadow:var(--shadow);
      white-space:pre-line;
    }
    @media (max-width: 900px){
      .reading-box{ font-size:18px; padding:18px 16px; max-width:100%; }
    }

    /* –†–∞–º–∫–∞ —Å–æ —Å–ª–æ–≤–∞–º–∏ + —Ç–∞–±–ª–∏—Ü–∞ (–∫–∞–∫ –≤ —ç—Ç–∞–ª–æ–Ω–µ) */
    .helper-box{
      border:1px solid #ccc;
      border-radius:8px;
      padding:14px 18px;
      background:var(--card);
      max-width:800px;
      margin:16px auto;
      font-size:18px;
      line-height:1.5;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
    }
    @media (max-width:900px){
      .helper-box{ font-size:16px; padding:12px 14px; max-width:95%; }
    }
    .wordlist{
      width:100%;
      border-collapse: collapse;
      font-size:18px;
      table-layout: fixed;
    }
    .wordlist th, .wordlist td{
      padding:6px 4px;
      border-bottom:1px solid #e4e7ef;
      vertical-align: middle;
    }
    .dark .wordlist th, .wordlist td{
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .wordlist th{ text-align:left; font-weight:600; }
    .wordlist td:nth-child(1){ width:35%; }
    .wordlist td:nth-child(2){ width:45%; }
    .wordlist td:nth-child(3){ width:20%; text-align:center; }
    .wordlist th:nth-child(3){ text-align:center; }
    .wordlist button.play{
      display:inline-flex; align-items:center; justify-content:center;
      line-height:1; min-width:36px; height:28px;
      border:none; color:#fff; border-radius:6px; padding:4px 8px; font-size:14px; cursor:pointer;
      background:linear-gradient(135deg, var(--primary), var(--primary-600));
      box-shadow:0 3px 8px rgba(43,108,255,.25);
      transition:transform .08s ease, filter .2s ease;
    }
    .wordlist button.play:hover{ transform:translateY(-1px); filter:brightness(1.05); }
  </style>
</head>
<body>
  <!-- –¢—É–º–±–ª–µ—Ä —Ç–µ–º—ã -->
  <button id="themeBtn" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåì –¢–µ–º–∞</button>

  <div class="wrap">
    <h1 id="h1">–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –í–∞—Ä–∏–∞–Ω—Ç <span id="varNum">?</span></h1>
    <div class="status" id="statusText" aria-live="polite">
      ‚úÖ –ó–∞–ø–∏—Å—å –≥–æ—Ç–æ–≤–∞. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–ª—É—à–∞—Ç—å –µ—ë –Ω–∏–∂–µ –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª.
    </div>

    <!-- –ü–ª–µ–µ—Ä -->
    <audio id="audio" controls></audio>
    <!-- –í–æ–ª–Ω–∞ -->
    <div id="waveWrap" class="wave-wrap">
      <canvas id="wave" class="wave"></canvas>
    </div>

    <div style="text-align:center;">
      <button class="btn" id="playBtn" type="button" aria-label="–ü—Ä–æ–∏–≥—Ä–∞—Ç—å –∑–∞–ø–∏—Å—å" disabled>‚ñ∂Ô∏è –ü—Ä–æ—Å–ª—É—à–∞—Ç—å</button>
      <button class="btn" id="downloadBtn" type="button" aria-label="–°–∫–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å" disabled>‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
      <a class="btn" id="repeatBtn" href="#" role="button" aria-label="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç">üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç</a>
    </div>

    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
    <div class="task-container" aria-labelledby="taskTitle" aria-describedby="inst">
      <p id="taskTitle" style="margin-top:0;">
        <strong>Task 1.</strong> Imagine that you are preparing a project with your friend.
        You have found some interesting material for the presentation and you want to read this text to your friend.
        You have <strong>1.5 minutes</strong> to read the text silently, then be ready to read it out loud.
        You will not have more than <strong>1.5 minutes</strong> to read it.
      </p>
      <div class="instruction" id="inst">You will read the text aloud for not more than 1.5 minutes.</div>
    </div>

    <!-- –¢–µ–∫—Å—Ç -->
    <div class="reading-box" id="textBox">Pyotr Ilyich Tchaikovsky, born in 1840 in Votkinsk, is one of the most celebrated Russian composers. His works, which include symphonies, operas, and ballets, have become an integral part of world culture. Masterpieces such as Swan Lake (1877), The Nutcracker (1892), and Eugene Onegin are performed regularly on prestigious stages across Europe, America, and Asia.

Tchaikovsky‚Äôs music is admired for its emotional depth and lyrical beauty. It reflects both the joy and the tragedy of human life, making it accessible to audiences of all generations. Despite international recognition, his career was not without difficulties. He faced harsh criticism and struggled with personal doubts, yet his creativity never ceased.

Today, Tchaikovsky‚Äôs legacy lives on in annual competitions, music schools, and concert halls. His name remains unique, although sometimes associated with controversial discussions about art and personal life.</div>

    <!-- –°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞ -->
    <div class="task-container helper-box" role="region" aria-labelledby="hardWordsTitle">
      <details>
        <summary id="hardWordsTitle" style="cursor:pointer; font-weight:700;">
          üîé –°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞ (–ø–æ–¥—Å–∫–∞–∑–∫–∞) ‚Äî –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å
        </summary>
        <div class="wordlist-wrap" style="margin-top:14px;">
          <table class="wordlist" aria-label="–°–ø–∏—Å–æ–∫ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª–æ–≤ —Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–µ–π –∏ –æ–∑–≤—É—á–∫–æ–π">
            <thead>
              <tr>
                <th>Word</th>
                <th>IPA</th>
                <th>Audio</th>
              </tr>
            </thead>
            <tbody id="hardWordsTbody"></tbody>
          </table>
        </div>
      </details>
    </div>

    <div style="text-align:center;">
      <a class="btn nav-btn" id="toVariants" href="#" role="button" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–±–æ—Ä—É –≤–∞—Ä–∏–∞–Ω—Ç–∞">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–±–æ—Ä—É –≤–∞—Ä–∏–∞–Ω—Ç–∞</a>
      <a class="btn nav-btn" id="toModeMenu" href="#" role="button" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–±–æ—Ä—É –∑–∞–¥–∞–Ω–∏—è">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–±–æ—Ä—É –∑–∞–¥–∞–Ω–∏—è</a>
      <a class="btn nav-btn" id="toTaskMenu" href="#" role="button" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–±–æ—Ä—É —Ä–µ–∂–∏–º–∞">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–±–æ—Ä—É —Ä–µ–∂–∏–º–∞</a>
      <a class="btn nav-btn" id="toHome"     href="#" role="button" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
  </div>

  <script type="module">
    import { toggleThemeInit, navigateOnce } from '../../../common.js';

    toggleThemeInit();

    const path = location.pathname;
    const m = path.match(/variant(\d+)/i);
    const varNum = m ? m[1] : '?';
    document.getElementById('varNum').textContent = varNum;
    document.title = `–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ó–∞–¥–∞–Ω–∏–µ 1 ¬∑ –í–∞—Ä–∏–∞–Ω—Ç ${varNum}`;

    function getBases(p){
      const i = p.indexOf('/ege/');
      if (i >= 0){
        const ROOT_BASE = p.slice(0, i + 1);
        const EGE_BASE  = p.slice(0, i + 5);
        return { ROOT_BASE, EGE_BASE };
      }
      return { ROOT_BASE: '/', EGE_BASE: '/ege/' };
    }
    const { ROOT_BASE, EGE_BASE } = getBases(path);

    const toVariants = document.getElementById('toVariants');
    if (toVariants){
      toVariants.href = path.replace(/\/variants\/variant\d+\/[^/]+$/i, '/variants/ege1.html');
    }
    document.getElementById('toModeMenu').href = `${EGE_BASE}ege_menu.html`;
    document.getElementById('toTaskMenu').href = `${EGE_BASE}ege.html`;
    document.getElementById('toHome').href     = `${ROOT_BASE}index.html`;

    function clearTask1State(){
      try{
        Object.keys(sessionStorage).forEach(k => { if (k.startsWith('ege1_')) sessionStorage.removeItem(k); });
        if (varNum && /^\d+$/.test(varNum)) sessionStorage.removeItem(`ege1_var${varNum}_prepare_endtime`);
      }catch{}
    }
    function clearAndGo(url){ clearTask1State(); navigateOnce(url); }

    const repeat = document.getElementById('repeatBtn');
    if (repeat){
      const repeatHref = path.replace(/_4_result\.html$/i, '_1_prepare.html');
      repeat.href = repeatHref;
      repeat.addEventListener('click', (e)=>{ e.preventDefault(); clearAndGo(repeatHref); });
    }

    document.querySelectorAll('.nav-btn').forEach(a=>{
      a.addEventListener('click', (e)=>{ e.preventDefault(); clearAndGo(a.href); });
    });

    window.addEventListener('pageshow', ()=>{ navigateOnce.lock = false; });

    const audioEl     = document.getElementById('audio');
    const playBtn     = document.getElementById('playBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const statusText  = document.getElementById('statusText');

    const waveWrap    = document.getElementById('waveWrap');
    const waveCanvas  = document.getElementById('wave');

    const base64     = sessionStorage.getItem('ege1_audio_base64');
    const mimeStored = (sessionStorage.getItem('ege1_audio_mime') || 'audio/webm').toLowerCase();

    let objectURL = null;
    const extByMime = {
      'audio/webm':'webm','audio/webm;codecs=opus':'webm',
      'audio/ogg':'ogg','audio/ogg;codecs=opus':'ogg',
      'audio/mp4':'m4a','audio/mpeg':'mp3','audio/wav':'wav'
    };
    const fileExt  = extByMime[mimeStored] || 'webm';
    const fileName = `ege1_variant${varNum}.${fileExt}`;

    function dataURLtoBlob(dataURL){
      const parts = (dataURL || '').split(',');
      if (parts.length < 2) return null;
      const header = parts[0], b64 = parts[1];
      const type = (header.match(/data:(.*?);base64/) || [,'application/octet-stream'])[1];
      const bin  = atob(b64);
      const bytes= new Uint8Array(bin.length);
      for (let i=0;i<bin.length;i++) bytes[i] = bin.charCodeAt(i);
      return new Blob([bytes], { type });
    }

    function setButtonsEnabled(en){
      playBtn.disabled = !en;
      downloadBtn.disabled = !en;
    }

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ + –≤–æ–ª–Ω—ã (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
    (async function initAudio(){
      if (!base64){
        statusText.textContent = '‚ö†Ô∏è –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∑–∞–ø—Ä–µ—Ç–∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.';
        setButtonsEnabled(false);
        return;
      }
      try{
        const blob = dataURLtoBlob(base64);
        if (blob){
          objectURL   = URL.createObjectURL(blob);
          audioEl.src = objectURL;
          audioEl.type= blob.type || mimeStored;
          await initWaveformFromURL(objectURL);
        }else{
          audioEl.src = base64;
          audioEl.type= mimeStored;
          await initWaveformFromURL(base64);
        }
        setButtonsEnabled(true);
      }catch{
        audioEl.src = base64;
        audioEl.type= mimeStored;
        setButtonsEnabled(true);
      }
    })();

    playBtn.addEventListener('click', ()=>{ if (audioEl.src) audioEl.play(); });
    downloadBtn.addEventListener('click', ()=>{
      if (!audioEl.src) return;
      const a = document.createElement('a');
      a.href = objectURL || base64;
      a.download = fileName;
      a.click();
    });

    window.addEventListener('pagehide', ()=>{ if (objectURL) URL.revokeObjectURL(objectURL); });
    window.addEventListener('beforeunload', ()=>{ if (objectURL) URL.revokeObjectURL(objectURL); });

    // ===== –í–æ–ª–Ω–æ–≤–æ–π –±–µ–≥—É–Ω–æ–∫
    async function initWaveformFromURL(url){
      try{
        const resp = await fetch(url);
        const buf  = await resp.arrayBuffer();
        const AC   = window.AudioContext || window.webkitAudioContext;
        const ctx  = new AC();
        const audioBuf = await ctx.decodeAudioData(buf);

        const peaks = buildPeaks(audioBuf, 1000);
        drawWave(peaks, 0);
        waveWrap.style.display = 'block';

        let raf;
        const tick = ()=>{
          const p = audioEl.currentTime / (audioBuf.duration || 1);
          drawWave(peaks, p);
          raf = requestAnimationFrame(tick);
        };
        audioEl.addEventListener('play', ()=>{ cancelAnimationFrame(raf); tick(); });
        audioEl.addEventListener('pause', ()=>{ cancelAnimationFrame(raf); drawWave(peaks, audioEl.currentTime/(audioBuf.duration||1)); });
        audioEl.addEventListener('ended', ()=>{ cancelAnimationFrame(raf); drawWave(peaks, 1); });

        waveCanvas.addEventListener('pointerdown', (e)=>{
          const r = waveCanvas.getBoundingClientRect();
          const x = Math.max(0, Math.min(1, (e.clientX - r.left)/r.width));
          audioEl.currentTime = x * audioBuf.duration;
          drawWave(peaks, x);
        }, {passive:true});
      }catch(err){
        console.warn('Waveform init failed:', err);
        waveWrap.style.display = 'none';
      }
    }

    function buildPeaks(audioBuf, width){
      const ch0 = audioBuf.getChannelData(0);
      const ch1 = audioBuf.numberOfChannels>1 ? audioBuf.getChannelData(1) : null;
      const total = ch0.length;
      const block = Math.floor(total / width) || 1;
      const peaks = new Array(width);
      for (let i=0;i<width;i++){
        const start = i*block, end = Math.min(total, start+block);
        let min=1, max=-1;
        for (let j=start;j<end;j++){
          const s = ch1 ? (ch0[j]+ch1[j])*0.5 : ch0[j];
          if (s<min) min=s; if (s>max) max=s;
        }
        peaks[i] = [min,max];
      }
      return peaks;
    }

    function drawWave(peaks, progress){
      const c = waveCanvas;
      const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
      const cssW = c.clientWidth || 600;
      const cssH = c.clientHeight || 48;
      if (c.width !== cssW*dpr) c.width = cssW*dpr;
      if (c.height!== cssH*dpr) c.height= cssH*dpr;
      const ctx = c.getContext('2d');
      ctx.setTransform(dpr,0,0,dpr,0,0);

      const rs = getComputedStyle(document.documentElement);
      const waveBase = (rs.getPropertyValue('--wave-base') || 'rgba(0,0,0,.28)').trim();
      const waveProg = (rs.getPropertyValue('--wave-prog') || '#2b6cff').trim();
      const waveGlow = (rs.getPropertyValue('--wave-glow') || 'rgba(43,108,255,.45)').trim();

      const bg = getComputedStyle(c).backgroundColor;

      ctx.clearRect(0,0,cssW,cssH);
      ctx.fillStyle = bg; ctx.fillRect(0,0,cssW,cssH);

      const mid = cssH/2;

      ctx.fillStyle = waveBase;
      for (let i=0;i<peaks.length;i++){
        const x = i/peaks.length*cssW;
        const [min,max] = peaks[i];
        const hTop = Math.abs(max)*mid;
        const hBot = Math.abs(min)*mid;
        ctx.fillRect(x, mid-hTop, 1, hTop+hBot || 1);
      }

      const progW = Math.max(0, Math.min(cssW, progress*cssW));
      ctx.save();
      ctx.beginPath();
      ctx.rect(0,0,progW,cssH);
      ctx.clip();

      ctx.fillStyle = waveProg;
      ctx.shadowColor = waveGlow;
      ctx.shadowBlur  = 8;
      for (let i=0;i<peaks.length;i++){
        const x = i/peaks.length*cssW;
        const [min,max] = peaks[i];
        const hTop = Math.abs(max)*mid;
        const hBot = Math.abs(min)*mid;
        ctx.fillRect(x, mid-hTop, 1, hTop+hBot || 1);
      }
      ctx.restore();
    }

    /* –ë–ª–æ–∫ "–°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞" ‚Äî —Å–ª–æ–≤–∞ –∏–∑ prepare (New Zealand) */
    const HARD_WORDS = [
  { w: 'celebrated',    ipa: '/Ààsel…™bre…™t…™d/' },
  { w: 'symphonies',    ipa: '/Ààs…™mf…ôniz/' },
  { w: 'integral',      ipa: '/Àà…™nt…™…°r…ôl/' },
  { w: 'masterpieces',  ipa: '/Ààm…ëÀêst…ôpiÀês…™z/' },
  { w: 'prestigious',   ipa: '/preÀàst…™d í…ôs/' },
  { w: 'recognition',   ipa: '/Àårek…ô…°Ààn…™ Én/' },
  { w: 'criticism',     ipa: '/Ààkr…™t…™s…™z…ôm/' },
  { w: 'creativity',    ipa: '/ÀåkriÀêe…™Ààt…™v…™ti/' },
  { w: 'legacy',        ipa: '/Ààle…°…ôsi/' },
  { w: 'controversial', ipa: '/Àåk…íntr…ôÀàv…úÀê Él/' }
];


    (function renderHardWords(){
      const tbody = document.getElementById('hardWordsTbody');
      if (!tbody) return;
      tbody.innerHTML = '';
      HARD_WORDS.forEach((item) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.w}</td>
          <td>${item.ipa}</td>
          <td><button class="play" type="button" aria-label="–ü—Ä–æ—Å–ª—É—à–∞—Ç—å ${item.w}"><span aria-hidden="true">‚ñ∂Ô∏é</span></button></td>
        `;
        tr.querySelector('button')?.addEventListener('click', () => speakWord(item.w));
        tbody.appendChild(tr);
      });
    })();

    // –û–∑–≤—É—á–∫–∞ —Å–ª–æ–≤
    let voices = [];
    function loadVoices(){ voices = window.speechSynthesis?.getVoices?.() || []; }
    loadVoices();
    if ('speechSynthesis' in window) {
      window.speechSynthesis.addEventListener('voiceschanged', loadVoices);
    }
    function pickEnglishVoice(){
      if (!voices || !voices.length) return null;
      const byLang = (substr) => voices.find(v => (v.lang || '').toLowerCase().startsWith(substr));
      return (byLang('en-gb')) || (byLang('en-us')) || voices.find(v => (v.lang || '').toLowerCase().startsWith('en')) || null;
    }
    function speakWord(word){
      try{
        if (!('speechSynthesis' in window)) return;
        const u = new SpeechSynthesisUtterance(word);
        const v = pickEnglishVoice();
        if (v) u.voice = v;
        u.rate = 0.95;
        u.lang = (v?.lang) || 'en-GB';
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      }catch(e){ console.warn('Speech error:', e); }
    }
  </script>
</body>
</html>
