<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Task 4 ‚Äî Preparation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- –®—Ä–∏—Ñ—Ç: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

  <!-- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ (—Ñ–æ–Ω, –∫–∞—Ä—Ç–æ—á–∫–∞, –∫–Ω–æ–ø–∫–∞, —Ñ–∏–∫—Å-–±–∞—Ä) -->
  <link rel="stylesheet" href="../../../style_common.css" />
  <!-- ^^^ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è –≤–≤–µ—Ä—Ö –¥–æ –ø–∞–ø–∫–∏ ege -->

  <!-- –ê–Ω—Ç–∏-–º–∏–≥–∞–Ω–∏–µ —Ç–µ–º—ã -->
  <script>
    (function(){
      try{
        const saved = localStorage.getItem('pref-theme') || 'light';
        if (saved === 'dark') document.documentElement.classList.add('dark');
      }catch(_){}
    })();
  </script>
</head>
<body>
  <!-- –¢—É–º–±–ª–µ—Ä —Ç–µ–º—ã -->
  <button id="themeBtn" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåì –¢–µ–º–∞</button>

  <div class="content-wrapper">
    <div class="task-container" aria-labelledby="taskTitle" aria-describedby="inst">
      <b id="taskTitle">4 Task. Imagine that you and your friend are doing a school project ‚ÄúHealthy lifestyle‚Äù.</b>
      You have found some photos to illustrate it but for technical reasons you cannot send them now. Leave a voice message to your friend explaining your choice of the photos and sharing some ideas about the project. <strong>In 2.5 minutes</strong> be ready to:
      <ul>
        <li>explain the choice of the illustrations for the project by briefly describing them and noting the differences;</li>
        <li>mention the advantages (1‚Äì2) of the two ways of keeping fit;</li>
        <li>mention the disadvantages (1‚Äì2) of the two ways of keeping fit;</li>
        <li>express your opinion on the subject of the project ‚Äì which way of keeping fit you‚Äôd prefer and why.</li>
      </ul>
      <div class="instruction" id="inst">
        You will speak for not more than 3 minutes (12‚Äì15 sentences). You have to talk continuously.
      </div>
    </div>

    <div class="images" aria-label="Project illustrations">
      <img src="1.jpg" alt="City holidays" loading="lazy">
      <img src="2.jpg" alt="Countryside holidays" loading="lazy">
    </div>

    <div style="text-align:center; margin-bottom:30px;">
      <button id="goBtn" class="button" type="button" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</button>
    </div>
  </div>

  <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å–Ω–∏–∑—É -->
  <div id="progressContainerFixed" role="timer" aria-live="polite" aria-label="–û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏">
    <div id="progressBarFixed">
      <span id="progressTime" class="progress-time">02:30</span>
    </div>
  </div>

  <!-- –õ–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <script type="module">
    import { toggleThemeInit, navigateOnce, startPrepareTimer, fmtTime } from "../../../common.js";
    // ^^^ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è –≤–≤–µ—Ä—Ö –¥–æ ege/common.js

    // === –¢–µ–º–∞ ===
    toggleThemeInit();

    // –°–ª—É–∂–µ–±–Ω—ã–µ –º–µ—Ç–∫–∏ ‚Äî –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ç–∞–π–º–µ—Ä
    try{
      sessionStorage.removeItem('ege4_audio_base64');
      sessionStorage.setItem('ege4_prepared','1');
      const meta = { preparedAt: Date.now(), prepareDurationSec: 150 };
      sessionStorage.setItem('ege4_meta', JSON.stringify(meta));
    }catch{}

    // URL —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞ (mic)
    const NEXT_URL = /_1_prepare\.html$/i.test(location.pathname)
      ? location.pathname.replace(/_1_prepare\.html$/i, '_2_mic.html')
      : location.pathname.replace(/\.html$/i, '_2_mic.html');

    // –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏"
    document.getElementById('goBtn')?.addEventListener('click', () => {
      navigateOnce(NEXT_URL);
    });

    // === –¢–∞–π–º–µ—Ä 2:30 —á–µ—Ä–µ–∑ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π rAF-—Ç–∞–π–º–µ—Ä ===
    const TOTAL_MS = 150_000;
    const barEl  = document.getElementById('progressBarFixed');
    const timeEl = document.getElementById('progressTime');
    barEl.classList.add('rAF');

    let stopTimer = null;

    function startTimerFresh(){
      timeEl.textContent = fmtTime(TOTAL_MS);
      barEl.style.width = '100%';

      stopTimer?.();
      stopTimer = startPrepareTimer({
        barEl,
        timeEl,
        totalMs: TOTAL_MS,
        nextUrl: NEXT_URL,
        key: 'ege4_prepare_end',
        persist: false,
        textEveryMs: 250,
        useRAF: true
      });
    }

    startTimerFresh();

    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞–∑–∞–¥ / BFCache
    function isBackForwardNav(){
      try {
        const nav = performance.getEntriesByType('navigation')[0];
        return nav && nav.type === 'back_forward';
      } catch { return false; }
    }

    window.addEventListener('pageshow', (e) => {
      navigateOnce.lock = false;
      if (e.persisted || isBackForwardNav()) {
        startTimerFresh();
      }
    });
  </script>
</body>
</html>
