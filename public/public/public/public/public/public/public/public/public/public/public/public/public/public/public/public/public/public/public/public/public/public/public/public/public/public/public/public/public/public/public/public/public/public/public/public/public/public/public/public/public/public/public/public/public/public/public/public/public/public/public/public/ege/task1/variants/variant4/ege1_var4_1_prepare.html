<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Task 1 ‚Äî Preparation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- –®—Ä–∏—Ñ—Ç Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="../../../style_common.css" />

  <!-- –ê–Ω—Ç–∏-–º–∏–≥–∞–Ω–∏–µ —Ç–µ–º—ã -->
  <script>
    (function(){
      try{
        const saved = localStorage.getItem('pref-theme') || 'light';
        if (saved === 'dark') document.documentElement.classList.add('dark');
      }catch(_){}
    })();
  </script>

  <style>
    /* –†–∞–º–∫–∞ —Ç–µ–∫—Å—Ç–∞ */
    .reading-box{
      background:var(--card);
      border:1px solid #ccc;
      border-radius:12px;
      box-shadow:var(--shadow);
      padding:24px 28px;
      text-align:left;
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      font-size:25px;
      line-height:1.7;
      max-width:1200px;
      margin:0 auto 24px;
      white-space:pre-line;
    }
    @media (max-width:900px){
      .reading-box{ font-size:18px; padding:18px 16px; max-width:100%; }
    }

    /* –ü–æ–¥—Å–∫–∞–∑–∫–∞-—Ä–∞–º–∫–∞ ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è */
    .helper-box{
      border:1px solid #ccc;          
      border-radius:8px;              
      padding:14px 18px;              
      background:var(--card);
      max-width:800px;                
      margin:16px auto;               
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      font-size:18px;
      line-height:1.5;
      box-shadow:0 2px 6px rgba(0,0,0,0.08); 
    }
    @media (max-width:900px){
      .helper-box{ font-size:16px; padding:12px 14px; max-width:100%; }
    }

    /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–ª–æ–≤ */
    .wordlist{
      width:100%;
      border-collapse: collapse;
      font-size:18px;
      table-layout: fixed;
    }
    .wordlist th, .wordlist td{
      padding:6px 4px;
      border-bottom:1px solid #e4e7ef;
      vertical-align: middle;
    }
    .dark .wordlist th, .wordlist td{
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .wordlist th{ text-align:left; font-weight:600; }
    .wordlist td:nth-child(1){ width:35%; }
    .wordlist td:nth-child(2){ width:45%; }
    .wordlist td:nth-child(3){ width:20%; text-align:center; }
    .wordlist th:nth-child(3){ text-align:center; }

    /* –ö–Ω–æ–ø–∫–∞ –æ–∑–≤—É—á–∫–∏ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
    .wordlist button.play{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      line-height:1;
      min-width:36px;
      height:28px;

      border:none;
      background:linear-gradient(135deg, var(--primary), var(--primary-600));
      color:#fff;
      border-radius:6px;
      padding:4px 8px;
      font-size:14px;
      cursor:pointer;
      box-shadow:0 3px 8px rgba(43,108,255,.25);
      transition:transform .08s ease, filter .2s ease;
    }
    .wordlist button.play:hover{ transform:translateY(-1px); filter:brightness(1.05); }
  </style>
</head>
<body>
  <!-- –¢—É–º–±–ª–µ—Ä —Ç–µ–º—ã -->
  <button id="themeBtn" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåì –¢–µ–º–∞</button>

  <div class="content-wrapper">
    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
    <div class="task-container" role="region" aria-labelledby="taskTitle">
      <p id="taskTitle" style="margin-top:0;">
        <strong>Task 1.</strong> Imagine that you are preparing a project with your friend.
        You have found some interesting material for the presentation and you want to read this text to your friend.
        You have <strong>1.5 minutes</strong> to read the text silently, then be ready to read it out loud.
        You will not have more than <strong>1.5 minutes</strong> to read it.
      </p>
    </div>

    <!-- –¢–µ–∫—Å—Ç -->
    <div class="reading-box" id="readingBox">Yuri Gagarin is one of the most famous people in Russian history. He was the first person to travel into space. His flight took place on the 12th of April, 1961, and lasted only 108 minutes, but it changed the world forever. He flew around the Earth in a spacecraft called Vostok 1.

Gagarin was born in a small village and studied to become a pilot. He was chosen for the space mission because of his excellent health, quick thinking, and strong personality. After his flight, he became a hero not only in the Soviet Union but also in many other countries.

People remember Gagarin for his bravery and his famous smile. He proved that space travel was possible and inspired future generations of scientists and astronauts. Today, many streets, schools, and even planets are named after him. Yuri Gagarin will always be a symbol of courage and progress.</div>

    <!-- –°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞ -->
    <div class="task-container helper-box" role="region" aria-labelledby="hardWordsTitle">
      <details>
        <summary id="hardWordsTitle" style="cursor:pointer; font-weight:700;">
          üîé –°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞ (–ø–æ–¥—Å–∫–∞–∑–∫–∞) ‚Äî –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å
        </summary>
        <div class="wordlist-wrap" style="margin-top:14px;">
          <table class="wordlist" aria-label="–°–ø–∏—Å–æ–∫ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª–æ–≤ —Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–µ–π –∏ –æ–∑–≤—É—á–∫–æ–π">
            <thead>
              <tr>
                <th>Word</th>
                <th>IPA</th>
                <th>Audio</th>
              </tr>
            </thead>
            <tbody id="hardWordsTbody"></tbody>
          </table>
        </div>
      </details>
    </div>

    <div style="text-align:center; margin:22px 0 30px;">
      <button id="goBtn" class="button" type="button" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</button>
    </div>
  </div>

  <!-- –ü—Ä–æ—Å—Ç–∞–≤–∫–∞ -->
  <div style="height: calc(var(--footer-h) + 24px);"></div>

  <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
  <div id="progressContainerFixed" role="timer" aria-live="polite" aria-atomic="true" aria-label="–û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏">
    <div id="progressBarFixed" class="rAF">
      <span id="progressTime" class="progress-time">01:30</span>
    </div>
  </div>

  <!-- –õ–æ–≥–∏–∫–∞ -->
  <script type="module">
    import { toggleThemeInit, navigateOnce, startPrepareTimer, fmtTime } from "../../../common.js";

    // –¢–µ–º–∞
    toggleThemeInit();

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    const NEXT_URL = location.pathname.replace(/_1_prepare\.html$/i, '_2_mic.html');
    document.getElementById('goBtn')?.addEventListener('click', () => navigateOnce(NEXT_URL));

    // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    try{
      sessionStorage.removeItem('ege1_audio_base64');
      sessionStorage.removeItem('ege1_audio_mime');
      sessionStorage.setItem('ege1_prepared', '1');
      sessionStorage.setItem('ege1_meta', JSON.stringify({
        preparedAt: Date.now(),
        prepareDurationSec: 90
      }));
    }catch{}

    // –¢–∞–π–º–µ—Ä
    const TOTAL_MS = 90_000;
    const barEl  = document.getElementById('progressBarFixed');
    const timeEl = document.getElementById('progressTime');
    let stopTimer = null;

    function startTimerFresh(){
      timeEl.textContent = fmtTime(TOTAL_MS);
      barEl.style.width  = '100%';
      try { stopTimer?.(); } catch {}
      stopTimer = startPrepareTimer({
        barEl,
        timeEl,
        totalMs: TOTAL_MS,
        nextUrl: NEXT_URL,
        key: 'ege1_prepare_end',
        persist: false,
        textEveryMs: 250,
        useRAF: true
      });
    }
    startTimerFresh();

    window.addEventListener('pageshow', (e)=>{
      try { navigateOnce.lock = false; } catch {}
      if (e.persisted) startTimerFresh();
    });

    // –°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
    const HARD_WORDS = [
      { w: 'Yuri Gagarin',   ipa: '/Ààj ä…ôri …°…ôÀà…°…ëÀêr…™n/' },
      { w: 'spacecraft',     ipa: '/Ààspe…™skr…ëÀêft/' },
      { w: 'Vostok 1',       ipa: '/Ààv…íst…ík w ån/' },
      { w: 'mission',        ipa: '/Ààm…™ É…ôn/' },
      { w: 'Soviet Union',   ipa: '/Ààso ävi…ôt ÀàjuÀêni…ôn/' },
      { w: 'bravery',        ipa: '/Ààbre…™v…ôri/' },
      { w: 'inspired',       ipa: '/…™nÀàspa…™…ôrd/' },
      { w: 'generations',    ipa: '/Àåd í…õn…ôÀàre…™ É…ônz/' },
      { w: 'astronauts',     ipa: '/Àà√¶str…ôn…îÀêts/' },
      { w: 'progress',       ipa: '/Ààpr…ô ä…°r…õs/' }
    ];

    (function renderHardWords(){
      const tbody = document.getElementById('hardWordsTbody');
      if (!tbody) return;
      tbody.innerHTML = '';
      HARD_WORDS.forEach((item) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.w}</td>
          <td>${item.ipa}</td>
          <td><button class="play" type="button" aria-label="–ü—Ä–æ—Å–ª—É—à–∞—Ç—å ${item.w}"><span aria-hidden="true">‚ñ∂Ô∏é</span></button></td>
        `;
        tr.querySelector('button').addEventListener('click', () => speakWord(item.w));
        tbody.appendChild(tr);
      });
    })();

    // –û–∑–≤—É—á–∫–∞
    let voices = [];
    function loadVoices(){ voices = window.speechSynthesis?.getVoices?.() || []; }
    loadVoices();
    if ('speechSynthesis' in window) {
      window.speechSynthesis.addEventListener('voiceschanged', loadVoices);
    }

    function pickEnglishVoice(){
      if (!voices || !voices.length) return null;
      const byLang = (substr) => voices.find(v => (v.lang || '').toLowerCase().startsWith(substr));
      return (byLang('en-gb')) || (byLang('en-us')) || voices.find(v => (v.lang || '').toLowerCase().startsWith('en')) || null;
    }

    function speakWord(word){
      try{
        if (!('speechSynthesis' in window)) return;
        const u = new SpeechSynthesisUtterance(word);
        const v = pickEnglishVoice();
        if (v) u.voice = v;
        u.rate = 0.95;
        u.lang = (v?.lang) || 'en-GB';
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      }catch(e){ console.warn('Speech error:', e); }
    }
  </script>
</body>
</html>
